import java.util.ArrayList;
import java.util.Random;
import java.util.Scanner;

public class Laboratorio19 {
    public static void main(String[] args) {
        Scanner scanner = new Scanner(System.in);
        Random random = new Random();
        Mapa mapa = new Mapa(10, 10);

        
        Ejercito ejercito1 = new Ejercito("Ejército 1");
        Ejercito ejercito2 = new Ejercito("Ejército 2");

        
        for (Soldado soldado : ejercito1.getSoldados()) {
            mapa.moverSoldado(soldado, soldado.getFila(), soldado.getColumna());
        }
        for (Soldado soldado : ejercito2.getSoldados()) {
            mapa.moverSoldado(soldado, soldado.getFila(), soldado.getColumna());
        }

        System.out.println("¡Comienza la batalla!");

        
        boolean turnoEjercito1 = true;
        while (!ejercito1.getSoldados().isEmpty() && !ejercito2.getSoldados().isEmpty()) {
            System.out.println("\nEstado actual del mapa:");
            mapa.mostrarMapa(ejercito1, ejercito2);

            Ejercito ejercitoActual = turnoEjercito1 ? ejercito1 : ejercito2;
            Ejercito ejercitoEnemigo = turnoEjercito1 ? ejercito2 : ejercito1;

            System.out.println("Turno de: " + ejercitoActual.getNombre());
            moverSoldado(ejercitoActual, ejercitoEnemigo, mapa, scanner, random);

            
            turnoEjercito1 = !turnoEjercito1;
        }

        
        if (ejercito1.getSoldados().isEmpty()) {
            System.out.println("¡El Ejército 2 gana!");
        } else {
            System.out.println("¡El Ejército 1 gana!");
        }
    }

    private static void moverSoldado(Ejercito ejercito, Ejercito enemigo, Mapa mapa, Scanner scanner, Random random) {
        ArrayList<Soldado> soldados = ejercito.getSoldados();
        Soldado soldadoSeleccionado = null;

        
        while (soldadoSeleccionado == null) {
            System.out.println("Soldados disponibles:");
            for (int i = 0; i < soldados.size(); i++) {
                Soldado s = soldados.get(i);
                System.out.println(i + ". " + s.getNombre() + " (Vida: " + s.getPuntosVida() + ")");
            }

            System.out.print("Seleccione el número de soldado: ");
            int opcion = scanner.nextInt();
            if (opcion >= 0 && opcion < soldados.size()) {
                soldadoSeleccionado = soldados.get(opcion);
            } else {
                System.out.println("Opción inválida. Intente de nuevo.");
            }
        }

        
        System.out.print("Ingrese nueva fila: ");
        int nuevaFila = scanner.nextInt();
        System.out.print("Ingrese nueva columna: ");
        int nuevaColumna = scanner.nextInt();

        
        if (!mapa.posicionValida(nuevaFila, nuevaColumna)) {
            System.out.println("Movimiento inválido. Intente de nuevo.");
            return;
        }

       
        Soldado enemigoEnPosicion = buscarEnemigoEnPosicion(enemigo, nuevaFila, nuevaColumna);
        if (enemigoEnPosicion != null) {
            System.out.println("¡Batalla entre " + soldadoSeleccionado.getNombre() + " y " + enemigoEnPosicion.getNombre() + "!");
            resolverBatalla(soldadoSeleccionado, enemigoEnPosicion, enemigo);
        }

        
        mapa.moverSoldado(soldadoSeleccionado, nuevaFila, nuevaColumna);
    }

    private static Soldado buscarEnemigoEnPosicion(Ejercito ejercito, int fila, int columna) {
        for (Soldado s : ejercito.getSoldados()) {
            if (s.getFila() == fila && s.getColumna() == columna) {
                return s;
            }
        }
        return null;
    }

    private static void resolverBatalla(Soldado soldado1, Soldado soldado2, Ejercito ejercitoEnemigo) {
        int vidaTotal = soldado1.getPuntosVida() + soldado2.getPuntosVida();
        double probabilidad1 = (double) soldado1.getPuntosVida() / vidaTotal;
        double probabilidad2 = (double) soldado2.getPuntosVida() / vidaTotal;

        Random random = new Random();
        double resultado = random.nextDouble();

        if (resultado <= probabilidad1) {
            System.out.println(soldado1.getNombre() + " gana la batalla.");
            soldado1.mover(soldado2.getFila(), soldado2.getColumna());
            soldado1.puntosVida++; 
            ejercitoEnemigo.getSoldados().remove(soldado2);
        } else {
            System.out.println(soldado2.getNombre() + " gana la batalla.");
            ejercitoEnemigo.getSoldados().remove(soldado1);
        }
    }
}

